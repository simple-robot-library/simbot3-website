(self.webpackChunksimbot_website=self.webpackChunksimbot_website||[]).push([[493],{5162:(e,n,t)=>{"use strict";t.d(n,{Z:()=>i});var a=t(7294),l=t(6010);const r="tabItem_Ymn6";function i(e){let{children:n,hidden:t,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,l.Z)(r,i),hidden:t},n)}},4866:(e,n,t)=>{"use strict";t.d(n,{Z:()=>x});var a=t(7462),l=t(7294),r=t(6010),i=t(6775),s=t(1980),o=t(7392),p=t(12);function u(e){return function(e){return l.Children.map(e,(e=>{if((0,l.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:n,label:t,attributes:a,default:l}}=e;return{value:n,label:t,attributes:a,default:l}}))}function d(e){const{values:n,children:t}=e;return(0,l.useMemo)((()=>{const e=n??u(t);return function(e){const n=(0,o.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function c(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const a=(0,i.k6)(),r=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,s._X)(r),(0,l.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(a.location.search);n.set(r,e),a.replace({...a.location,search:n.toString()})}),[r,a])]}function v(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,r=d(e),[i,s]=(0,l.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!c({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const a=t.find((e=>e.default))??t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:r}))),[o,u]=m({queryString:t,groupId:a}),[v,k]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,r]=(0,p.Nk)(t);return[a,(0,l.useCallback)((e=>{t&&r.set(e)}),[t,r])]}({groupId:a}),N=(()=>{const e=o??v;return c({value:e,tabValues:r})?e:null})();(0,l.useLayoutEffect)((()=>{N&&s(N)}),[N]);return{selectedValue:i,selectValue:(0,l.useCallback)((e=>{if(!c({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);s(e),u(e),k(e)}),[u,k,r]),tabValues:r}}var k=t(2466),N=t(2389);const g="tabList__CuJ",E="tabItem_LNqP";function b(e){let{className:n,block:t,selectedValue:i,selectValue:s,tabValues:o}=e;const p=[],{blockElementScrollPositionUntilNextRender:u}=(0,k.o5)(),d=e=>{const n=e.currentTarget,t=p.indexOf(n),a=o[t].value;a!==i&&(u(n),s(a))},c=e=>{var n;let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=p.indexOf(e.currentTarget)+1;t=p[n]??p[0];break}case"ArrowLeft":{const n=p.indexOf(e.currentTarget)-1;t=p[n]??p[p.length-1];break}}null==(n=t)||n.focus()};return l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":t},n)},o.map((e=>{let{value:n,label:t,attributes:s}=e;return l.createElement("li",(0,a.Z)({role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,key:n,ref:e=>p.push(e),onKeyDown:c,onClick:d},s,{className:(0,r.Z)("tabs__item",E,null==s?void 0:s.className,{"tabs__item--active":i===n})}),t??n)})))}function C(e){let{lazy:n,children:t,selectedValue:a}=e;if(t=Array.isArray(t)?t:[t],n){const e=t.find((e=>e.props.value===a));return e?(0,l.cloneElement)(e,{className:"margin-top--md"}):null}return l.createElement("div",{className:"margin-top--md"},t.map(((e,n)=>(0,l.cloneElement)(e,{key:n,hidden:e.props.value!==a}))))}function y(e){const n=v(e);return l.createElement("div",{className:(0,r.Z)("tabs-container",g)},l.createElement(b,(0,a.Z)({},e,n)),l.createElement(C,(0,a.Z)({},e,n)))}function x(e){const n=(0,N.Z)();return l.createElement(y,(0,a.Z)({key:String(n)},e))}},1610:(e,n,t)=>{"use strict";t.d(n,{Z:()=>r});var a=t(7294);const l="label_Yf5u";function r(e){let{type:n,href:t,children:r,title:i}=e;n=n||"primary",i=i||"";const s=a.createElement("span",{className:l,title:i},a.createElement("span",{className:`badge badge--${n}`},r));return null!=t&&t.length>0?a.createElement("a",{href:t},s):s}},9263:(e,n,t)=>{"use strict";t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>p,default:()=>v,frontMatter:()=>o,metadata:()=>u,toc:()=>c});var a=t(7462),l=(t(7294),t(3905)),r=t(8209),i=(t(1610),t(4866)),s=t(5162);const o={sidebar_position:15,title:"\u76d1\u542c\u51fd\u6570",toc_max_heading_level:4},p=void 0,u={unversionedId:"basic/event-listener",id:"basic/event-listener",title:"\u76d1\u542c\u51fd\u6570",description:"\u76d1\u542c\u51fd\u6570\uff0c\u7528\u4e8e\u627f\u8f7d\u5bf9\u4e8b\u4ef6\u7684\u5904\u7406\u903b\u8f91\u3002",source:"@site/docs/basic/event-listener.md",sourceDirName:"basic",slug:"/basic/event-listener",permalink:"/docs/basic/event-listener",draft:!1,editUrl:"https://github.com/simple-robot-library/simbot3-website/tree/main/docs/basic/event-listener.md",tags:[],version:"current",lastUpdatedBy:"ForteScarlet",lastUpdatedAt:1681938802,formattedLastUpdatedAt:"2023\u5e744\u670819\u65e5",sidebarPosition:15,frontMatter:{sidebar_position:15,title:"\u76d1\u542c\u51fd\u6570",toc_max_heading_level:4},sidebar:"docs",previous:{title:"Application",permalink:"/docs/basic/application"},next:{title:"\u4e8b\u4ef6\u76d1\u542c",permalink:"/docs/basic/event-listening"}},d={},c=[{value:"\u76d1\u542c\u51fd\u6570",id:"\u76d1\u542c\u51fd\u6570",level:2},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49",level:3},{value:"\u5b9e\u73b0",id:"\u5b9e\u73b0",level:3},{value:"\u6784\u9020",id:"\u6784\u9020",level:3},{value:"\u76f4\u63a5\u6784\u9020",id:"\u76f4\u63a5\u6784\u9020",level:4},{value:"\u6784\u9020\u5668",id:"\u6784\u9020\u5668",level:4},{value:"\u4e8b\u4ef6\u5904\u7406\u7ed3\u679c",id:"\u4e8b\u4ef6\u5904\u7406\u7ed3\u679c",level:2},{value:"\u4f20\u9012\u4e0e\u83b7\u53d6",id:"\u4f20\u9012\u4e0e\u83b7\u53d6",level:3},{value:"\u7279\u6b8a\u7c7b\u578b\u4e0e\u6784\u9020",id:"\u7279\u6b8a\u7c7b\u578b\u4e0e\u6784\u9020",level:3},{value:"\u65e0\u6548\u7684\u5904\u7406\u7ed3\u679c",id:"\u65e0\u6548\u7684\u5904\u7406\u7ed3\u679c",level:4},{value:"\u53ef\u54cd\u5e94\u5f0f\u7684\u5904\u7406\u7ed3\u679c",id:"\u53ef\u54cd\u5e94\u5f0f\u7684\u5904\u7406\u7ed3\u679c",level:4},{value:"\u5f02\u6b65\u7684\u5904\u7406\u7ed3\u679c",id:"\u5f02\u6b65\u7684\u5904\u7406\u7ed3\u679c",level:4},{value:"\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u5668",id:"\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u5668",level:2},{value:"\u5b9a\u4e49",id:"\u5b9a\u4e49-1",level:3},{value:"\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u63cf\u8ff0",id:"\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u63cf\u8ff0",level:3},{value:"\u76d1\u542c\u51fd\u6570\u7684\u6ce8\u518c",id:"\u76d1\u542c\u51fd\u6570\u7684\u6ce8\u518c",level:2},{value:"\u76d1\u542c\u51fd\u6570\u53e5\u67c4",id:"\u76d1\u542c\u51fd\u6570\u53e5\u67c4",level:3}],m={toc:c};function v(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"\u76d1\u542c\u51fd\u6570\uff0c\u7528\u4e8e\u627f\u8f7d\u5bf9\u4e8b\u4ef6\u7684\u5904\u7406\u903b\u8f91\u3002"),(0,l.kt)("h2",{id:"\u76d1\u542c\u51fd\u6570"},"\u76d1\u542c\u51fd\u6570"),(0,l.kt)("h3",{id:"\u5b9a\u4e49"},"\u5b9a\u4e49"),(0,l.kt)("p",null,"\u8ba9\u6211\u4eec\u6765\u4e86\u89e3\u4e00\u4e0b\u4ec0\u4e48\u662f",(0,l.kt)("strong",{parentName:"p"},"\u76d1\u542c\u51fd\u6570"),"\u3002\u4e0b\u9762\u662f\u76d1\u542c\u51fd\u6570\uff08\u6709\u6240\u7b80\u5316\uff09\u7684\u57fa\u672c\u5b9a\u4e49\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"public interface EventListener : ... {\n    /** \u68c0\u6d4b\u67d0\u4e8b\u4ef6\u7c7b\u578b\u662f\u5426\u4e3a\u5f53\u524d\u4e8b\u4ef6\u6240\u9700\u8981\u7684\u7c7b\u578b */\n    public fun isTarget(event: Event.Key<*>): Boolean\n    \n    /** \u5bf9\u4e8b\u4ef6\u8fdb\u884c\u5339\u914d */\n    public suspend fun match(context: EventListenerProcessingContext): Boolean\n\n    /** \u5982\u679c [match] \u5339\u914d\u6210\u529f\uff0c\u5904\u7406\u6b64\u4e8b\u4ef6\u5e76\u5f97\u5230\u4e00\u4e2a\u7ed3\u679c */\n    public suspend fun invoke(context: EventListenerProcessingContext): EventResult\n    \n    // \u5176\u4ed6...\n}\n")),(0,l.kt)("p",null,"\u53ef\u4ee5\u770b\u5f97\u51fa\u6765\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\uff0c\u5176\u4e3b\u8981\u5b58\u5728\u4e24\u4e2a\u57fa\u672c\u529f\u80fd\uff0c\u5c31\u662f\u5bf9\u4e8b\u4ef6\u7684\u5339\u914d\u548c\u4e8b\u4ef6\u7684\u5904\u7406\u3002\n\u8fd9\u5176\u4e2d\uff0c\u201c\u4e8b\u4ef6\u7684\u5339\u914d\u201d\u88ab\u5206\u4e3a\u4e86\u4e24\u4e2a\u6b65\u9aa4\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u7528\u4ee3\u7801\u6765\u8868\u793a\u4e00\u6b21\u4e8b\u4ef6\u7684\u5904\u7406\uff0c\u90a3\u4e48\u5b83\u5927\u6982\u662f\u5982\u4e0b\u7684\u6548\u679c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val eventContext = ...\n\nval listener = ...\n\nif (listener.isTarget(eventContext.event.key) && listener.match(eventContext)) {\n    return listener.invoke(eventContext)\n} else {\n    return EventResult.invalid()\n}\n")),(0,l.kt)("admonition",{title:"Context?",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u6709\u5173 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventProcessingContext"),"\uff08\u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerProcessingContext"),"\uff09 \u7684\u4fe1\u606f\u53ef\u53c2\u8003",(0,l.kt)("a",{parentName:"p",href:"../definition/event-overview/event-processing-context"},(0,l.kt)("strong",{parentName:"a"},"\u4e8b\u4ef6\u5904\u7406\u4e0a\u4e0b\u6587")),"\u3002")),(0,l.kt)("h3",{id:"\u5b9e\u73b0"},"\u5b9e\u73b0"),(0,l.kt)("p",null,"\u65e2\u7136\u77e5\u9053\u4e86\u76d1\u542c\u51fd\u6570\u7684\u5b9a\u4e49\uff0c\u90a3\u4e48\u6211\u4eec\u4fbf\u53ef\u4ee5\u901a\u8fc7\u4efb\u610f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7c7b\u578b\u6765\u5b9e\u73b0\u5b83\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u4ee5\u76d1\u542c",(0,l.kt)("strong",{parentName:"p"},"\u597d\u53cb\u6d88\u606f\u4e8b\u4ef6"),'\u4e3a\u4f8b\uff0c\u521b\u5efa\u4e00\u4e2a\u5f53\u597d\u53cb\u53d1\u9001"\u5728\u5417"\u65f6\u56de\u590d"\u5728\u7684"\u7684\u76d1\u542c\u51fd\u6570\u3002'),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'class MyListener : EventListener {\n    override fun <T : Any> getAttribute(attribute: Attribute<T>): T? = null\n    \n    /**\n     * \u4e8b\u4ef6\u7c7b\u578b\u5339\u914d\n     */\n    override fun isTarget(eventType: Event.Key<*>): Boolean = eventType isSub FriendMessageEvent\n    \n    /**\n     * \u4e8b\u4ef6\u5339\u914d\n     */\n    override suspend fun match(context: EventListenerProcessingContext): Boolean {\n        return "\u5728\u5417" == context.textContent?.trim()\n    }\n    \n    /**\n     * \u4e8b\u4ef6\u5904\u7406\n     */\n    override suspend fun invoke(context: EventListenerProcessingContext): EventResult {\n        (context.event as FriendMessageEvent).reply("\u5728\u7684")\n        return EventResult.defaults()\n    }\n}\n'))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("admonition",{title:"\u6302\u8d77\u4e0e\u963b\u585e",type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u5f53\u901a\u8fc7Java\u5b9e\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"suspend")," \u51fd\u6570\u7684\u65f6\u5019\uff0c\u51fd\u6570\u53c2\u6570\u4e2d\u4f1a\u591a\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"Continuation<? super xxx> $completion")," \u53c2\u6570\u3002\n",(0,l.kt)("strong",{parentName:"p"},"\u7406\u8bba\u4e0a"),"\u6765\u8bb2\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u65e0\u89c6\u5b83\uff0c\u5e76\u76f4\u63a5\u5f00\u59cb\u4f60\u7684\u963b\u585e\u5f0f\u903b\u8f91\u3002\u8fd9\u5927\u6982\u662f\u53ef\u884c\u7684\uff0c\n\u8fd9\u4f1a\u4f7f\u5f97\u8fd9\u4e2a\u51fd\u6570\u672c\u8d28\u4e0a\u4ecd\u65e7\u662f\u963b\u585e\u51fd\u6570\u3002"),(0,l.kt)("p",{parentName:"admonition"},"\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\uff0c\u8fd9\u65f6\u5019\u51fd\u6570\u7684\u8fd4\u56de\u503c\u4f1a\u53d8\u6210 ",(0,l.kt)("inlineCode",{parentName:"p"},"Object"),". \u4f46\u662f\u4f60\u5b9e\u9645\u8fd4\u56de\u7684\u5185\u5bb9\u4ecd\u7136\u8981\u4e0e\u6b63\u786e\u7684\u51fd\u6570\u5b9a\u4e49\u76f8\u543b\u5408\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class MyListener implements EventListener {\n\n    @Nullable\n    @Override\n    public <T> T getAttribute(@NotNull Attribute<T> attribute) {\n        return null;\n    }\n\n    /**\n     * \u4e8b\u4ef6\u7c7b\u578b\u5339\u914d\n     */\n    @Override\n    public boolean isTarget(@NotNull Event.Key<?> eventType) {\n        // \u5224\u65ad\u76ee\u6807\u662f\u5426\u4e3a \'\u597d\u53cb\u6d88\u606f\u4e8b\u4ef6\'\n        return Event.Key.isSub(eventType, FriendMessageEvent.Key);\n    }\n\n    /**\n     * \u4e8b\u4ef6\u5339\u914d\n     */\n    @Nullable\n    @Override\n    public Object match(@NotNull EventListenerProcessingContext context, @NotNull Continuation<? super Boolean> $completion) {\n        String textContent = context.getTextContent();\n        if (textContent == null) {\n            return false;\n        }\n\n        return textContent.trim().equals("\u5728\u5417");\n        // return type: boolean, non-null\n    }\n\n    /**\n     * \u4e8b\u4ef6\u5904\u7406\n     */\n    @Override\n    public Object invoke(EventListenerProcessingContext context, Continuation<? super EventResult> continuation) {\n        ((FriendMessageEvent) context.getEvent()).replyBlocking("\u5728\u7684");\n        return EventResult.defaults();\n        // return type: EventResult, non-null\n    }\n}\n')))),(0,l.kt)("p",null,"\u5f53\u7136\uff0c\u5728\u8fd9\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u53ef\u80fd\u4f1a\u53d1\u73b0\u4e00\u4e9b\u95ee\u9898\uff0c\u6bd4\u5982\u5339\u914d\u5b8c\u6210\u540e\u8fd8\u9700\u8981\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"invoke")," \u4e2d\u8fdb\u884c\u7c7b\u578b\u8f6c\u5316\u7b49\uff0c\n\u8fd9\u663e\u7136\u5e76\u4e0d\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u7c7b\u578b\u5b89\u5168\u65b9\u6848\u3002\u4f46\u662f\u5f53\u7136\uff0c\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u6700\u5feb\u7684\u529e\u6cd5\u5c31\u662f\u5c06\u6240\u6709\u7684\u903b\u8f91\u90fd\u653e\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"invoke")," \u4e2d\uff0c\n\u4e00\u6c14\u5475\u6210\uff1a"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'class MyListener : EventListener {\n    override fun <T : Any> getAttribute(attribute: Attribute<T>): T? = null\n    \n    /** \u4e8b\u4ef6\u7c7b\u578b\u5339\u914d\uff0c\u65e0\u903b\u8f91\uff0c\u76f4\u63a5\u5f97\u5230true */\n    override fun isTarget(eventType: Event.Key<*>): Boolean = true // eventType isSub FriendMessageEvent\n    \n    /** \u4e8b\u4ef6\u5339\u914d\uff0c\u65e0\u903b\u8f91\uff0c\u76f4\u63a5\u5f97\u5230true */\n    override suspend fun match(context: EventListenerProcessingContext): Boolean = true\n    \n    /** \u4e8b\u4ef6\u5904\u7406 */\n    override suspend fun invoke(context: EventListenerProcessingContext): EventResult {\n        context.event.let { event ->\n            if (event is FriendMessageEvent && "\u5728\u5417" == context.textContent?.trim()) {\n                event.reply("\u5728\u7684")\n                return EventResult.defaults()\n            }\n        }\n        \n        // \u6ca1\u6709\u5339\u914d\u6210\u529f\n        return EventResult.invalid()\n    }\n}\n'))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("admonition",{title:"\u6302\u8d77\u4e0e\u963b\u585e",type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u5f53\u901a\u8fc7Java\u5b9e\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"suspend")," \u51fd\u6570\u7684\u65f6\u5019\uff0c\u51fd\u6570\u53c2\u6570\u4e2d\u4f1a\u591a\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"Continuation<? super xxx> $completion")," \u53c2\u6570\u3002\n",(0,l.kt)("strong",{parentName:"p"},"\u7406\u8bba\u4e0a"),"\u6765\u8bb2\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u65e0\u89c6\u5b83\uff0c\u5e76\u76f4\u63a5\u5f00\u59cb\u4f60\u7684\u963b\u585e\u5f0f\u903b\u8f91\u3002\u8fd9\u5927\u6982\u662f\u53ef\u884c\u7684\uff0c\n\u8fd9\u4f1a\u4f7f\u5f97\u8fd9\u4e2a\u51fd\u6570\u672c\u8d28\u4e0a\u4ecd\u65e7\u662f\u963b\u585e\u51fd\u6570\u3002"),(0,l.kt)("p",{parentName:"admonition"},"\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\uff0c\u8fd9\u65f6\u5019\u51fd\u6570\u7684\u8fd4\u56de\u503c\u4f1a\u53d8\u6210 ",(0,l.kt)("inlineCode",{parentName:"p"},"Object"),". \u4f46\u662f\u4f60\u5b9e\u9645\u8fd4\u56de\u7684\u5185\u5bb9\u4ecd\u7136\u8981\u4e0e\u6b63\u786e\u7684\u51fd\u6570\u5b9a\u4e49\u76f8\u543b\u5408\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'public class MyListener implements EventListener {\n\n    @Nullable\n    @Override\n    public <T> T getAttribute(@NotNull Attribute<T> attribute) {\n        return null;\n    }\n\n    /**\n     * \u4e8b\u4ef6\u7c7b\u578b\u5339\u914d\uff0c\u65e0\u903b\u8f91\uff0c\u76f4\u63a5\u5f97\u5230true\n     */\n    @Override\n    public boolean isTarget(@NotNull Event.Key<?> eventType) {\n        return true;\n        // return Event.Key.isSub(eventType, FriendMessageEvent.Key);\n    }\n\n    /**\n     * \u4e8b\u4ef6\u5339\u914d\uff0c\u65e0\u903b\u8f91\uff0c\u76f4\u63a5\u5f97\u5230true\n     */\n    @Nullable\n    @Override\n    public Object match(@NotNull EventListenerProcessingContext context, @NotNull Continuation<? super Boolean> $completion) {\n        return true;\n    }\n\n    /**\n     * \u4e8b\u4ef6\u5904\u7406\n     */\n    @Override\n    public Object invoke(EventListenerProcessingContext context, Continuation<? super EventResult> continuation) {\n        Event event = context.getEvent();\n        if (event instanceof FriendMessageEvent\n            && "\u5728\u5417".equals(trim(context.getTextContent()))) {\n\n            ((FriendMessageEvent) event).replyBlocking("\u5728\u7684");\n            return EventResult.defaults();\n        }\n\n\n        return EventResult.invalid();\n        // return type: EventResult, non-null\n    }\n\n    private static String trim(String nullableValue) {\n        return nullableValue == null ? null : nullableValue.trim();\n    }\n}\n')))),(0,l.kt)("p",null,"\u60c5\u51b5\u6bd4\u4e4b\u524d\u597d\u4e00\u4e9b\u4e86\uff0c\u4e0d\u662f\u5417\uff1f\u4f46\u8fd8\u662f\u4e0d\u90a3\u4e48\u4ee4\u4eba\u6ee1\u610f\u3002\u5c06\u6240\u6709\u7684\u903b\u8f91\u90fd\u5806\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"invoke")," \u4e2d\uff0c\n\u90a3\u4e48\u5728\u53ef\u80fd\u4f1a\u5728\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"isTarget")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"match")," \u8fdb\u884c\u5185\u90e8\u4f18\u5316\u7684\u65f6\u5019\u7834\u574f\u6574\u4e2a\u7f13\u5b58\u4f53\u7cfb\uff0c\n\u4f7f\u5176\u4e27\u5931\u4f18\u5316\u7a7a\u95f4\u3002"),(0,l.kt)("p",null,"\u4e0d\u4ec5\u5982\u6b64\uff0c\u5728Java\u6216\u5176\u4ed6\u4e0d\u652f\u6301\u6302\u8d77\u51fd\u6570\u7684\u8bed\u8a00\u4e2d\u60f3\u8981\u5b9e\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener")," \u4e5f\u4f1a\u6709\u5f88\u5927\u7684\u96be\u5ea6\u548c\u8f83\u9ad8\u7684\u51fa\u9519\u7387\u3002"),(0,l.kt)("p",null,"\u56e0\u6b64\uff0c\u5b9e\u9645\u4e0a\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u4e0d\u5e94\u8be5\u81ea\u5df1\u5b9e\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener"),"\u3002\n\u6838\u5fc3\u5e93\u4e2d\u5411\u4f7f\u7528\u8005\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7528\u4e8e\u5feb\u901f\u6784\u5efa ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener")," \u5b9e\u4f8b\u7684\u8f85\u52a9\u6784\u9020\u65b9\u6cd5\u3002"),(0,l.kt)("h3",{id:"\u6784\u9020"},"\u6784\u9020"),(0,l.kt)("p",null,"\u6838\u5fc3\u5e93\u63d0\u4f9b\u4e86\u4e00\u79cd\u6700\u57fa\u672c\u7684\u5b9e\u73b0\uff1a",(0,l.kt)("code",null,(0,l.kt)("b",null,"Simple"),"Listener")," \u3002"),(0,l.kt)("admonition",{title:"\u969c\u773c\u6cd5?",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u901a\u8fc7\u5404\u79cd\u5f62\u5982 ",(0,l.kt)("inlineCode",{parentName:"p"},"simpleListener(...)")," \u4e4b\u7c7b\u7684\u51fd\u6570\u6784\u9020\u800c\u6765\u7684\u7ed3\u679c\u5e76\u4e0d\u4e00\u5b9a\u662f\u7c7b\u578b ",(0,l.kt)("inlineCode",{parentName:"p"},"SimpleListener"),"\u3002")),(0,l.kt)("h4",{id:"\u76f4\u63a5\u6784\u9020"},"\u76f4\u63a5\u6784\u9020"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = simpleListener(FriendMessageEvent, matcher = { \n    // it: FriendMessageEvent\n    // this: EventListenerProcessingContext\n    textContent == "\u5728\u5417"\n}) { event: FriendMessageEvent -> \n    // this: EventListenerProcessingContext\n    event.reply("\u5728\u7684")\n    EventResult.defaults()\n}\n')),(0,l.kt)("p",null,"\u6216\u8005\u9009\u62e9\u53ea\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"invoke")," \u5904\u7406\u4e8b\u4ef6\uff0c\u4e0d\u63d0\u4f9b ",(0,l.kt)("inlineCode",{parentName:"p"},"matcher")," \u5339\u914d\u51fd\u6570\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = simpleListener(FriendMessageEvent) { event: FriendMessageEvent -> \n    // this: EventListenerProcessingContext\n    if (this.textContent == "\u5728\u5417") {\n        event.reply("\u5728\u7684")\n        EventResult.defaults()\n    } else {\n        EventResult.invalid()\n    }\n}\n'))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleListeners.listener(\n        /* target =  */ FriendMessageEvent.Key,\n\n        /* matcher = */ (context, event) -> "\u5728\u5417".equals(trim(context.getTextContent())),\n        /* invoker = */ (context, event) -> {\n            event.replyBlocking("\u5728\u7684");\n            return EventResult.defaults();\n            // \u8fd4\u56de\u503c\u53ef\u9009, \u5982\u679c\u4e0d\u63d0\u4f9b\u9ed8\u8ba4\u503c\u5219\u89c6\u4e3a EventResult.invalid() .\n        }\n);\n\n////////////\n\nprivate static String trim(String nullableValue) {\n    return nullableValue == null ? null : nullableValue.trim();\n}\n')),(0,l.kt)("p",null,"\u6216\u8005\u9009\u62e9\u53ea\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"invoke")," \u5904\u7406\u4e8b\u4ef6\uff0c\u4e0d\u63d0\u4f9b ",(0,l.kt)("inlineCode",{parentName:"p"},"matcher")," \u5339\u914d\u51fd\u6570\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleListeners.listener(\n        /* target =  */ FriendMessageEvent.Key,\n\n        /* invoker = */ (context, event) -> {\n            if ("\u5728\u5417".equals(trim(context.getTextContent()))) {\n                event.replyBlocking("\u5728\u7684");\n                return EventResult.defaults();\n            } else {\n                return EventResult.invalid();\n            }\n            // return EventResult.invalid();\n            // \u8fd4\u56de\u503c\u53ef\u9009, \u5982\u679c\u4e0d\u63d0\u4f9b\u9ed8\u8ba4\u503c\u5219\u89c6\u4e3a EventResult.invalid() .\n        }\n);\n\n////////////\n\nprivate static String trim(String nullableValue) {\n    return nullableValue == null ? null : nullableValue.trim();\n}\n')))),(0,l.kt)("h4",{id:"\u6784\u9020\u5668"},"\u6784\u9020\u5668"),(0,l.kt)("p",null,"\u9664\u4e86\u76f4\u63a5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"simpleListener")," \u6784\u5efa\u6700\u7ec8\u5b9e\u4f8b\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"Builder")," \u6765\u5206\u6b65\u64cd\u4f5c\u3002"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = buildSimpleListener(FriendMessageEvent) {\n    match { textContent?.trim() == "\u5728\u5417" }\n    process { event -> event.reply("\u5728\u7684") }\n}\n')),(0,l.kt)("p",null,"\u4e5f\u8bb8\u4f60\u53d1\u73b0\u4e86\uff0c\u5728\u4e0a\u8ff0\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"process { ... }")," \u5e76\u6ca1\u6709\u8fd4\u56de ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u7c7b\u578b\u7684\u7ed3\u679c\u3002\n\u5b9e\u9645\u4e0a\uff0c\u4e0a\u8ff0\u8fd9\u6bb5\u4ee3\u7801\u7684\u771f\u6b63\u6837\u8c8c\u5e94\u8be5\u662f\u8fd9\u6837\u7684\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = buildSimpleListener(FriendMessageEvent) {\n    match { textContent?.trim() == "\u5728\u5417" }\n    handle { event ->\n        event.reply("\u5728\u7684")\n        EventResult.invalid()\n    }\n}\n')),(0,l.kt)("p",null,"\u6b64\u65f6\u53ef\u4ee5\u6ce8\u610f\u5230\uff0c\u8fd9\u6b21\u4f7f\u7528\u7684\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"handle { ... }")," \u800c\u5e76\u975e ",(0,l.kt)("inlineCode",{parentName:"p"},"process"),"\u3002\n",(0,l.kt)("inlineCode",{parentName:"p"},"process")," \u5373\u4ee3\u8868\u4e00\u4e2a\u8fd4\u56de\u9ed8\u8ba4\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.invalid")," \u7684\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u4f53\uff0c\n\u5982\u679c\u4f60\u4e0d\u5173\u5fc3\u5f53\u524d\u4e8b\u4ef6\u8fd4\u56de\u4ec0\u4e48\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u5c06\u5176 ",(0,l.kt)("strong",{parentName:"p"},"\u65e0\u6548\u5316"),"\uff0c\u5373\u8fd4\u56de ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.invalid"),"\u3002"),(0,l.kt)("p",null,"\u4e0d\u8fc7\u76f8\u5e94\u7684\uff0c\u540e\u7eed\u5176\u4ed6\u76d1\u542c\u51fd\u6570\u4e5f\u5c06\u65e0\u6cd5\u5f97\u5230\u6b64\u76d1\u542c\u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\u3002")),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleListenerBuilder<FriendMessageEvent> builder = new SimpleListenerBuilder<>(FriendMessageEvent.Key);\n\nbuilder.match((context, event) -> "\u5728\u5417".equals(trim(context.getTextContent())));\nbuilder.process((context, event) -> event.replyBlocking("\u5728\u7684"));\n\nEventListener listener = builder.build();\n\n/////\n\nprivate static String trim(String nullableValue) {\n    return nullableValue == null ? null : nullableValue.trim();\n}\n')),(0,l.kt)("p",null,"\u53ef\u4ee5\u6ce8\u610f\u5230\uff0c\u8fd9\u91cc\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"process { ... }")," \u5e76\u672a\u9700\u8981\u8fd4\u56de\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult"),"\u3002\n",(0,l.kt)("inlineCode",{parentName:"p"},"process")," \u5373\u4ee3\u8868\u4e00\u4e2a\u8fd4\u56de\u9ed8\u8ba4\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.invalid")," \u7684\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u4f53\uff0c\n\u5982\u679c\u4f60\u4e0d\u5173\u5fc3\u5f53\u524d\u4e8b\u4ef6\u8fd4\u56de\u4ec0\u4e48\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u5c06\u5176 ",(0,l.kt)("strong",{parentName:"p"},"\u65e0\u6548\u5316"),"\uff0c\u5373\u8fd4\u56de ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.invalid"),"\u3002"),(0,l.kt)("p",null,"\u4e0d\u8fc7\u76f8\u5e94\u7684\uff0c\u540e\u7eed\u5176\u4ed6\u76d1\u542c\u51fd\u6570\u4e5f\u5c06\u65e0\u6cd5\u5f97\u5230\u6b64\u76d1\u542c\u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u793a\u4f8b\u4e2d\u5c55\u793a\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"handle { ... }")," \u81ea\u5b9a\u4e49\u54cd\u5e94\u503c\u7684\u65b9\u5f0f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleListenerBuilder<FriendMessageEvent> builder = new SimpleListenerBuilder<>(FriendMessageEvent.Key);\n\nbuilder.match((context, event) -> "\u5728\u5417".equals(trim(context.getTextContent())));\nbuilder.handle((context, event) -> {\n    event.replyBlocking("\u5728\u7684");\n    return EventResult.defaults();\n});\n\nEventListener listener = builder.build();\n\n/////\n\nprivate static String trim(String nullableValue) {\n    return nullableValue == null ? null : nullableValue.trim();\n}\n')))),(0,l.kt)("admonition",{title:"\u4e8b\u4ef6\u5904\u7406\u7ed3\u679c",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u6709\u5173 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u7684\u63cf\u8ff0\u4f1a\u5728\u672c\u7ae0",(0,l.kt)("a",{parentName:"p",href:"#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E7%BB%93%E6%9E%9C"},"\u7a0d\u540e"),"\u4ecb\u7ecd\u3002")),(0,l.kt)("p",null,"\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"SimpleListenerBuilder")," \u4e2d\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"process")," \u6216 ",(0,l.kt)("inlineCode",{parentName:"p"},"handle")," \u4e8c\u8005\u4e4b\u4e00\u5fc5\u987b\u6709\u4e14\u53ea\u88ab\u914d\u7f6e\u4e00\u6b21\u3002\n\u6362\u8a00\u4e4b\uff0c\u4f60\u5fc5\u987b\u914d\u7f6e\u5f53\u524d\u76d1\u542c\u51fd\u6570\u7684",(0,l.kt)("strong",{parentName:"p"},"\u5904\u7406\u903b\u8f91"),"\u3002"),(0,l.kt)("p",null,"\u4e0b\u9762\u793a\u4f8b\u4e2d\u7684\u5185\u5bb9\u5c06",(0,l.kt)("strong",{parentName:"p"},"\u4e0d\u80fd"),"\u6210\u529f\u6784\u5efa ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener"),", \u56e0\u4e3a\u5b83\u4eec\u6ca1\u6709\u63d0\u4f9b\u5177\u4f53\u7684\u4e8b\u4ef6\u5904\u7406\u903b\u8f91\uff0c\u6216\u8005\u914d\u7f6e\u4e86\u591a\u6b21\u5904\u7406\u903b\u8f91\uff1a"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u6ca1\u6709\u914d\u7f6e\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = buildSimpleListener(FriendMessageEvent) {\n    match { textContent?.trim() == "\u5728\u5417" }\n    // error-start\n    // \u6ca1\u6709\u914d\u7f6e\u4e8b\u4ef6\u5904\u7406\u903b\u8f91\n    // error-end\n}\n')),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u91cd\u590d\u914d\u7f6e\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = buildSimpleListener(FriendMessageEvent) {\n    match { textContent?.trim() == "\u5728\u5417" }\n    // error-start\n    // \u91cd\u590d\u914d\u7f6e\u4e8b\u4ef6\u5904\u7406\u903b\u8f91\n    process { event.reply("\u5728\u7684") }\n    process { event.reply("\u5728\u7684!!!") }\n    // error-end\n}\n'))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u6ca1\u6709\u914d\u7f6e\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleListenerBuilder<FriendMessageEvent> builder = new SimpleListenerBuilder<>(FriendMessageEvent.Key);\n\nbuilder.match((context, event) -> "\u5728\u5417".equals(context.getTextContent()));\n// error-start\n// \u6ca1\u6709\u914d\u7f6e\u4e8b\u4ef6\u5904\u7406\u903b\u8f91\n// error-end\n\nEventListener listener = builder.build();\n')),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u91cd\u590d\u914d\u7f6e\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleListenerBuilder<FriendMessageEvent> builder = new SimpleListenerBuilder<>(FriendMessageEvent.Key);\n\nbuilder.match((context, event) -> "\u5728\u5417".equals(context.getTextContent()));\n// error-start\n// \u91cd\u590d\u914d\u7f6e\u4e8b\u4ef6\u5904\u7406\u903b\u8f91\nbuilder.process((context, event) -> event.replyBlocking("\u5728\u7684"));\nbuilder.process((context, event) -> event.replyAsync("\u5728\u7684!!!"));\n// error-end\n\nEventListener listener = builder.build();\n')))),(0,l.kt)("p",null,"\u867d\u7136\u4e8b\u4ef6\u5904\u7406\u903b\u8f91\u80fd\u4e14\u5fc5\u987b\u914d\u7f6e\u4e00\u6b21\uff0c\u4f46\u662f\u5bf9\u4e8e\u4e8b\u4ef6",(0,l.kt)("strong",{parentName:"p"},"\u5339\u914d\u903b\u8f91"),"\u6765\u8bb2\uff0c\u5c31\u6ca1\u6709\u8fd9\u4e48\u4e25\u683c\u4e86\u3002"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u914d\u7f6e\u4e00\u6b21\u5339\u914d\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = buildSimpleListener(FriendMessageEvent) {\n    // success-start\n    match { textContent?.trim() == "\u5728\u5417" }\n    // success-end\n    process { /* ... */ }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u914d\u7f6e\u591a\u6b21\u5339\u914d\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = buildSimpleListener(FriendMessageEvent) {\n    // success-start\n    match { textContent != null }\n    match { textContent!!.trim() == "\u5728\u5417" }\n    // success-end\n    process { /* ... */ }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u4e0d\u914d\u7f6e\u5339\u914d\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener = buildSimpleListener(FriendMessageEvent) {\n    // success-start\n    // \u4e8b\u4ef6\u5339\u914d\u53ef\u4ee5\u5ffd\u7565\n    // success-end\n    process { /* ... */ }\n}\n"))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u914d\u7f6e\u4e00\u6b21\u5339\u914d\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleListenerBuilder<FriendMessageEvent> builder = new SimpleListenerBuilder<>(FriendMessageEvent.Key);\n\n// success-start\nbuilder.match((context, event) -> "\u5728\u5417".equals(context.getTextContent()));\n// success-end\n\nbuilder.process(() -> { /* ... */ });\n\nEventListener listener = builder.build();\n')),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u914d\u7f6e\u591a\u6b21\u5339\u914d\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'SimpleListenerBuilder<FriendMessageEvent> builder = new SimpleListenerBuilder<>(FriendMessageEvent.Key);\n\n// success-start\nbuilder.match((context, event) -> context.getTextContent() != null);\nbuilder.match((context, event) -> "\u5728\u5417".equals(context.getTextContent()));\n// success-end\n\nbuilder.process(() -> { /* ... */ });\n\nEventListener listener = builder.build();\n')),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"\u4e0d\u914d\u7f6e\u5339\u914d\u903b\u8f91:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"SimpleListenerBuilder<FriendMessageEvent> builder = new SimpleListenerBuilder<>(FriendMessageEvent.Key);\n\n// success-start\n// \u4e0d\u914d\u7f6e\u5339\u914d\u903b\u8f91\n// success-end\n\nbuilder.process(() -> { /* ... */ });\n\nEventListener listener = builder.build();\n")))),(0,l.kt)("admonition",{title:"\u591a\u6b21\u65f6..",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u5f53\u914d\u7f6e\u4e86\u591a\u4e2a\u4e8b\u4ef6\u5339\u914d\u903b\u8f91\u65f6\uff0c\u591a\u6b21\u5339\u914d\u7ed3\u679c\u4e4b\u95f4\u662f ",(0,l.kt)("strong",{parentName:"p"},"\u4e0e(&&)")," \u5173\u7cfb\u8fde\u63a5\u7684\u3002\u5f62\u5982 ",(0,l.kt)("inlineCode",{parentName:"p"},"match1(...) && match2(...)"),"\u3002")),(0,l.kt)("h2",{id:"\u4e8b\u4ef6\u5904\u7406\u7ed3\u679c"},"\u4e8b\u4ef6\u5904\u7406\u7ed3\u679c"),(0,l.kt)("p",null,"\u6bcf\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u7684\u4e8b\u4ef6\u5904\u7406\u903b\u8f91\u7684\u6700\u540e\uff0c\u90fd\u9700\u8981\u8fd4\u56de\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u7c7b\u578b\u6765\u63cf\u8ff0\u672c\u6b21\u4e8b\u4ef6\u5904\u7406\u7684",(0,l.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\u3002"),(0,l.kt)("p",null,"\u9996\u5148\u6765\u770b\u4e00\u4e0b ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u7684\uff08\u7b80\u5316\u7248\uff09\u5b9a\u4e49\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"public interface EventResult {\n    \n    /**\n     * \u76d1\u542c\u51fd\u6570\u6240\u8fd4\u56de\u7684\u771f\u6b63\u5185\u5bb9\u3002\n     */\n    public val content: Any?\n    \n    \n    /**\n     * \u662f\u5426\u963b\u6b62\u4e0b\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u7684\u6267\u884c\u3002\n     */\n    public val isTruncated: Boolean\n}\n")),(0,l.kt)("p",null,"\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u4e2d\u5b9a\u4e49\u7684\u57fa\u672c\u5c5e\u6027\u53ea\u6709\u4e24\u4e2a\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"content")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"isTruncated"),"\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"content")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"content")," \u4ee3\u8868\u672c\u6b21\u4e8b\u4ef6\u5904\u7406\u540e\u7684\u4e00\u79cd",(0,l.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\u3002\u4ece\u5b9a\u4e49\u6765\u770b\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"content")," \u6ca1\u6709\u4efb\u4f55\u7c7b\u578b\u8981\u6c42\uff0c\u5e76\u4e14\u5141\u8bb8\u4e3anull\uff0c\n\u662f\u4e00\u4e2a\u6beb\u65e0\u9650\u5236\u7684\u5c5e\u6027\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"content")," \u5411\u540e\u7eed\u5176\u4ed6\u76d1\u542c\u51fd\u6570\u4f20\u9012\u4efb\u4f55\u4fe1\u606f\uff0c\u6216\u8005...\u4ec0\u4e48\u4e5f\u4e0d\u4f20\u9012\uff0c\u800c\u53ea\u662f\u7ed9\u4e00\u4e2anull\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"isTruncated")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"isTruncated")," \u5c5e\u6027\u7684\u4f5c\u7528\u4f1a\u4f53\u73b0\u5728\u672c\u6b21\u76d1\u542c\u51fd\u6570\u5bf9\u4e8b\u4ef6\u5904\u7406\u7684\u6d41\u7a0b\u7ed3\u675f\u4e4b\u540e\u3002\u5982\u679c ",(0,l.kt)("inlineCode",{parentName:"p"},"isTruncated")," \u503c\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"true"),"\uff0c\n\u5219\u4f18\u5148\u7ea7\u4f4e\u4e8e\u5f53\u524d\u76d1\u542c\u51fd\u6570\u7684\u540e\u7eed\u5176\u4ed6\u51fd\u6570\u5c06\u4e0d\u4f1a\u5728\u88ab\u8c03\u5ea6\u3002\u6574\u4e2a\u4e8b\u4ef6\u8c03\u5ea6\u8981\u4e48\u4f1a\u5b8c\u5b8c\u6574\u6574\u5730\u6309\u7167\u4f18\u5148\u7ea7\u6267\u884c\u5b8c\u6240\u6709\u7684\u76d1\u542c\u51fd\u6570\uff0c\n\u8981\u4e48\u4f1a\u5728\u7b2c\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"isTruncated")," \u503c\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"true")," \u7684\u5730\u65b9\u7ec8\u6b62\u3002"),(0,l.kt)("h3",{id:"\u4f20\u9012\u4e0e\u83b7\u53d6"},"\u4f20\u9012\u4e0e\u83b7\u53d6"),(0,l.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u63d0\u5230 ",(0,l.kt)("em",{parentName:"p"},'"\u5411\u540e\u7eed\u5176\u4ed6\u76d1\u542c\u51fd\u6570\u4f20\u9012\u4efb\u4f55\u4fe1\u606f"'),"\uff0c\u8fd9\u8bf4\u660e ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u662f\u53ef\u4ee5\u5411\u540e\u4f20\u9012\u7684\u3002\n\u90a3\u4e48\u6211\u4eec\u5e94\u8be5\u600e\u4e48\u83b7\u53d6\u8f83\u65e9\u6267\u884c\u7684\u76d1\u542c\u51fd\u6570\u7684\u54cd\u5e94\u7ed3\u679c\u5462\uff1f"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"EventProcessingContext.result")," \u5411\u5f53\u524d\u76d1\u542c\u51fd\u6570\u66b4\u9732\u4e86\u6574\u4e2a\u4e8b\u4ef6\u5904\u7406\u6d41\u7a0b\u4e2d\u4e8b\u4ef6\u54cd\u5e94\u7684\u7ed3\u679c\u96c6\u89c6\u56fe\uff1a"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener = buildSimpleListener(FriendMessageEvent) {\n    // ...\n    process { event ->\n        // this: EventListenerProcessingContext\n        // \u83b7\u53d6\u7b2c\u4e00\u4e2a\u88ab\u6267\u884c\u7684\u76d1\u542c\u51fd\u6570\u7684\u54cd\u5e94\u503c\n        val firstListenerResult = this.results.first()\n        // \u83b7\u53d6\u6700\u540e\u4e00\u4e2a\uff0c\u7406\u8bba\u4e0a\u4e5f\u662f\u5f53\u524d\u76d1\u542c\u51fd\u6570\u7684\u4e0a\u4e00\u4e2a\u521a\u6267\u884c\u5b8c\u7684\u76d1\u542c\u51fd\u6570\u7684\u7ed3\u679c\n        val lastListenerResult = this.results.last()\n        \n        // ...\n        \n        EventResult.invalid()\n    }\n}\n"))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"EventListener listener = SimpleListeners.listener(Event.Root, (context, event) -> {\n    // \u83b7\u53d6\u7b2c\u4e00\u4e2a\u88ab\u6267\u884c\u7684\u76d1\u542c\u51fd\u6570\u7684\u54cd\u5e94\u503c\n    final EventResult first = context.getResults().get(0);\n    // \u83b7\u53d6\u6700\u540e\u4e00\u4e2a\uff0c\u7406\u8bba\u4e0a\u4e5f\u662f\u5f53\u524d\u76d1\u542c\u51fd\u6570\u7684\u4e0a\u4e00\u4e2a\u521a\u6267\u884c\u5b8c\u7684\u76d1\u542c\u51fd\u6570\u7684\u7ed3\u679c\n    final EventResult last = context.getResults().get(context.size() - 1);\n\n    // ...\n});\n")))),(0,l.kt)("admonition",{title:"\u66f4\u52a0\u8c28\u614e...",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"\u5b9e\u9645\u5e94\u7528\u4e2d\u6ce8\u610f\u5bf9\u5f02\u5e38\u60c5\u51b5\u7684\u5904\u7406\uff0c\u4f8b\u5982\u7d22\u5f15\u8d8a\u754c\u3002")),(0,l.kt)("h3",{id:"\u7279\u6b8a\u7c7b\u578b\u4e0e\u6784\u9020"},"\u7279\u6b8a\u7c7b\u578b\u4e0e\u6784\u9020"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u63d0\u4f9b\u4e86\u4e00\u4e9b\u57fa\u7840\u7684\u5b9e\u73b0\uff0c\u5e76\u4e14\u8fd9\u4e9b\u57fa\u7840\u5b9e\u73b0\u6709\u7740\u5b83\u4eec\u5404\u81ea\u7684\u7279\u6b8a\u542b\u4e49\u3002"),(0,l.kt)("p",null,"\u9996\u5148\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u6838\u5fc3\u5e93\u4e2d ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u4e0e\u5176\u9ed8\u8ba4\u5b9e\u73b0\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a"),(0,l.kt)(r.G,{config:'{"theme":{"light":"neutral","dark":"forest"}}',chart:"classDiagram\ndirection BT\ninterface EventResult\nclass AsyncEventResult\nclass Invalid\nclass ReactivelyCollectableEventResult\nclass SimpleEventResult\nclass SpecialEventResult\n\nInvalid  --\x3e  SpecialEventResult \nReactivelyCollectableEventResult  --\x3e  SpecialEventResult \nAsyncEventResult  --\x3e  SpecialEventResult \nSimpleEventResult  --\x3e  ReactivelyCollectableEventResult \nSpecialEventResult  ..>  EventResult \n",mdxType:"Mermaid"}),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6709\u4e00\u4e2a\u4e00\u770b\u540d\u5b57\u5c31\u77e5\u9053\u6bd4\u8f83\u201c\u7279\u6b8a\u201d\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"SpecialEventResult"),"\u3002\u5b83\u662f\u4e00\u4e2a\u5b9e\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u7684\u5bc6\u5c01\u7c7b\uff0c\n\u7528\u4e8e\u7ea6\u675f\u90a3\u4e9b\u5177\u6709\u7279\u6b8a\u89c4\u5219\u7684\u5b50\u7c7b\u578b\u3002"),(0,l.kt)("h4",{id:"\u65e0\u6548\u7684\u5904\u7406\u7ed3\u679c"},"\u65e0\u6548\u7684\u5904\u7406\u7ed3\u679c"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Invalid")," \u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"SpecialEventResult")," \u7684\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"object")," \u5b9e\u73b0\u3002\u987e\u540d\u601d\u4e49\uff0c\u5b83\u4ee3\u8868",(0,l.kt)("strong",{parentName:"p"},"\u65e0\u6548\u7684"),"\u8fd4\u56de\u503c\u3002\n\u5f53\u4e00\u6b21\u4e8b\u4ef6\u5904\u7406\u540e\u7684\u8fd4\u56de\u503c\u7ed3\u679c\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"Invalid")," \u7684\u65f6\u5019\uff0c\u672c\u6b21\u8fd4\u56de\u503c\u5c06\u4f1a\u88ab",(0,l.kt)("strong",{parentName:"p"},"\u5ffd\u7565\u5e76\u4e22\u5f03"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"Invalid")," \u5c06\u4e0d\u4f1a\u88ab\u8bb0\u5f55\u5e76\u4f20\u9012\u7ed9\u540e\u7eed\u6d41\u7a0b\u3002"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u76f4\u63a5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"strong"},"Invalid"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener = simpleListener(FooEvent) {\n    EventResult.Invalid\n}\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"strong"},"EventResult")," \u7684\u5de5\u5382\u65b9\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener = simpleListener(FooEvent) {\n    EventResult.invalid()\n}\n"))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u76f4\u63a5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"strong"},"Invalid"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"EventListener listener = SimpleListeners.listener(Event.Root, (context, event) -> {\n    return EventResult.Invalid.INSTANCE;\n});\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"strong"},"EventResult")," \u7684\u5de5\u5382\u65b9\u6cd5")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"EventListener listener = SimpleListeners.listener(Event.Root, (context, event) -> {\n    return EventResult.invalid();\n});\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u6216\u8005\u4e0d\u505a\u5904\u7406(\u5229\u7528\u9ed8\u8ba4\u503c)")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"EventListener listener = SimpleListeners.listener(Event.Root, (context, event) -> {\n    // default return: EventResult.Invalid()\n});\n")))),(0,l.kt)("h4",{id:"\u53ef\u54cd\u5e94\u5f0f\u7684\u5904\u7406\u7ed3\u679c"},"\u53ef\u54cd\u5e94\u5f0f\u7684\u5904\u7406\u7ed3\u679c"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ReactivelyCollectableEventResult")," \u662f\u5b9e\u73b0\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"SpecialEventResult")," \u7684\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u8ba9\u6211\u4eec\u6765\u53c2\u8003\u4e00\u4e0b\u5b83\u7684\u5b9a\u4e49\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"/**\n * \u4ee3\u8868 [content] \u53ef\u80fd\u4e3a\u4e00\u4e2a\u53cd\u5e94\u5f0f\u7684\u7ed3\u679c\uff0c\u5e76\u4e14\u5141\u8bb8\u5176\u5728\u4e00\u4e2a\u51fd\u6570\u7ed3\u675f\u65f6\u8fdb\u884c\u6536\u96c6\u3002\n */\npublic abstract class ReactivelyCollectableEventResult : SpecialEventResult() {\n    \n    /**\n     *\n     * \u5f53 [content] \u7684\u8fd4\u56de\u503c\u4e3a _reactive api_ \u76f8\u5173\u6216\u5f02\u6b65\u7ed3\u679c\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4e14\u5f53\u524d [EventResult] \u5b9e\u4f8b\u4e3a **[ReactivelyCollectableEventResult]** \u7c7b\u578b\u7684\u65f6\u5019\uff0c\n     * \u5904\u7406\u5668\u5e94\u5f53\u5bf9\u8fd9\u7c7b\u76f8\u5173\u7684api\u8fdb\u884c\u6536\u96c6\u3002\u8fd9\u901a\u5e38\u4f7f\u7528\u5728Java\u4f7f\u7528\u8005\u6216\u8005\u4e0e\u5176\u4ed6reactive API\u914d\u5408\u4f7f\u7528\u7684\u65f6\u5019\u3002\n     * ...(\u7565)\n     */\n    abstract override val content: Any?\n    \n    /**\n     * \u5f53\u54cd\u5e94\u5f0f\u7ed3\u679c [content] \u88ab\u6536\u96c6\u5b8c\u6bd5\u540e\u901a\u8fc7 [collected] \u63d0\u4f9b\u5176\u6536\u96c6\u7684\u7ed3\u679c [collectedContent],\n     * \u5e76\u4f5c\u4e3a\u4e00\u4e2a\u65b0\u7684 [EventResult] \u7ed3\u679c\u63d0\u4f9b\u7ed9 [EventProcessingResult.results].\n     *\n     * [collected] \u7684\u7ed3\u679c\u4e0d\u4f1a\u518d\u88ab\u4e8c\u6b21\u6536\u96c6, \u56e0\u6b64\u5047\u82e5 [collectedContent] \u4ecd\u7136\u4e3a\u54cd\u5e94\u5f0f\u7c7b\u578b, \u5219\u5b83\u4eec\u5c06\u4f1a\u88ab\u5ffd\u7565\u5e76\u76f4\u63a5\u4f5c\u4e3a\u7ed3\u679c\u8fd4\u56de.\n     */\n    public abstract fun collected(collectedContent: Any?): EventResult\n    \n}\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ReactivelyCollectableEventResult")," \u5728\u5904\u7406 ",(0,l.kt)("inlineCode",{parentName:"p"},"content")," \u65f6\u4f1a\u591a\u5b58\u5728\u4e00\u4e2a\u6b65\u9aa4\uff0c\u5373\u5f53\u51fd\u6570\u5904\u7406\u7ed3\u679c\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"ReactiveCollectableEventResult"),"\n\u7c7b\u578b\uff0c\u4e14 ",(0,l.kt)("inlineCode",{parentName:"p"},"content")," \u7c7b\u578b\u4e3a\u4e00\u4e2a reactive(\u54cd\u5e94\u5f0f) \u7c7b\u578b\u6216\u53ef\u4ee5\u652f\u6301\u7684 async(\u5f02\u6b65) \u7c7b\u578b\u65f6\uff0c\u4f1a\u6302\u8d77\u5e76\u7b49\u5f85\u5176\u7ed3\u679c\u7684\u6536\u96c6\u3002\n\u5f53\u6b64\u53cd\u5e94\u5f0f\u7c7b\u578b\u6216\u5f02\u6b65\u7c7b\u578b\u5f97\u5230\u7ed3\u679c\u65f6\u5728\u8fdb\u884c\u4e0b\u4e00\u6b65\u6d41\u7a0b\u3002"),(0,l.kt)("admonition",{title:"\u7c7b\u578b\u4e0e\u4f9d\u8d56",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u7684\u7c7b\u578b\u90fd\u80fd\u5728\u4efb\u4f55\u73af\u5883\u4e0b\u88ab\u6536\u96c6\uff0c\u5b83\u4eec\u5927\u90e8\u5206\u90fd\u6709\u5404\u81ea\u7684",(0,l.kt)("strong",{parentName:"p"},"\u73af\u5883\u8981\u6c42"),"\uff1a"),(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"kotlinx.coroutines.Deferred"),": \u9700\u8981\u62e5\u6709 ",(0,l.kt)("inlineCode",{parentName:"li"},"Kotlin Coroutines")," \u73af\u5883\u3002\u4f9d\u8d56\u81ea\u5e26"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"java.util.concurrent.CompletionStage"),": \u9700\u8981\u5728 ",(0,l.kt)("inlineCode",{parentName:"li"},"JDK8")," \u73af\u5883\u4e0b\u3002JVM\u5e73\u53f0\u4f9d\u8d56\u81ea\u5e26"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"\u5176\u4ed6")," \u5176\u4ed6\u7c7b\u578b\uff08\u4f8b\u5982 ",(0,l.kt)("inlineCode",{parentName:"li"},"reactor")," \u76f8\u5173\u6216 ",(0,l.kt)("inlineCode",{parentName:"li"},"rxjava")," \u76f8\u5173\u4e4b\u7c7b\u7684\uff09\u90fd\u9700\u8981\u6dfb\u52a0\u989d\u5916\u7684\u4f9d\u8d56\uff0c\n\u8fd9\u4e9b\u4f9d\u8d56\u7684\u4fe1\u606f\u53ef\u4ee5\u5728 ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/Kotlin/kotlinx.coroutines/blob/master/reactive/README.md"},"\u8fd9\u91cc"),"\n\u53c2\u8003\u3002")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"\u652f\u6301\u6536\u96c6\u7684\u7c7b\u578b\u53c2\u8003"),(0,l.kt)("ul",{parentName:"admonition"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"java.util.concurrent.CompletionStage")," (",(0,l.kt)("inlineCode",{parentName:"li"},"java.util.concurrent.CompletableFuture"),")"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"kotlinx.coroutines.Deferred")," (\u4e0d\u652f\u6301 ",(0,l.kt)("inlineCode",{parentName:"li"},"kotlinx.coroutines.Job"),")"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"kotlinx.coroutines.flow.Flow")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"org.reactivestreams.Publisher")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"reactor.core.publisher.Flux")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"reactor.core.publisher.Mono")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.CompletableSource")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.SingleSource")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.MaybeSource")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.ObservableSource")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.Flowable")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.rxjava3.core.CompletableSource")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.rxjava3.core.SingleSource")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.rxjava3.core.MaybeSource")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.rxjava3.core.ObservableSource")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"io.reactivex.rxjava3.core.Flowable"))))),(0,l.kt)("p",null,"\u4e5f\u5c31\u662f\u8bf4\uff0c\u5047\u5982\u4f60\u7684\u4ee3\u7801\u662f\u7c7b\u4f3c\u4e8e\u8fd9\u6837\u7684\uff1a"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener1 = simpleListener(FooEvent) { event ->\n    EventResult.of(event.bot.async {\n        println("Hi")\n        // \u7b49\u5f855s\n        delay(5000)\n        // \u5f97\u5230\u771f\u6b63\u7684\u7ed3\u679c\n        "Async Result"\n    })\n}\n\nval listener2 = simpleListener(FooEvent) {\n    println("Hello")\n    EventResult.invalid()\n}\n\neventListenerRegistrar.register(listener1)\neventListenerRegistrar.register(listener2)\n\n'))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'EventListener listener1 = SimpleListeners.listener(FooEvent.Key, (context, event) -> {\n    DelayableCompletableFuture<String> future = event.getBot()\n            // \u7b49\u5f855s\n            .delayAndCompute(5000, () -> {\n                System.out.println("Hi");\n                // \u5f97\u5230\u771f\u6b63\u7684\u4e8b\u4ef6\u54cd\u5e94\u503c\n                return "Async Result";\n            });\n\n    return EventResult.of(future);\n});\n\nEventListener listener2 = SimpleListeners.listener(FooEvent.Key, (context, event) -> {\n    System.out.println("Hello");\n});\n\neventListenerRegistrar.register(listener1);\neventListenerRegistrar.register(listener2);\n')))),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("em",{parentName:"p"},"\u6211\u4eec\u5047\u8bbe ",(0,l.kt)("inlineCode",{parentName:"em"},"listener1")," \u4f1a\u6bd4 ",(0,l.kt)("inlineCode",{parentName:"em"},"listener2")," \u66f4\u65e9\u6267\u884c"))),(0,l.kt)("p",null,"\u90a3\u4e48\u5f53\u4e00\u6b21\u4e8b\u4ef6\u88ab\u8c03\u5ea6\uff0c\u63a7\u5236\u53f0\u51fa\u73b0 ",(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"Hi"))," \u4e4b\u540e5s\u624d\u4f1a\u51fa\u73b0 ",(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("inlineCode",{parentName:"strong"},"Hello")),"\uff0c\n\u56e0\u4e3alistener1\u7684\u8fd4\u56de\u503c\u88ab",(0,l.kt)("strong",{parentName:"p"},"\u6302\u8d77\u7b49\u5f85\u4e86"),"\u3002"),(0,l.kt)("admonition",{title:"\u963b\u585e?",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},'\u5982\u679c\u4f60\u6bd4\u8f83\u719f\u6089Kotlin\u534f\u7a0b\u6216\u8005\u53cd\u5e94\u5f0fAPI\u4e4b\u7c7b\u7684\u5185\u5bb9\u7684\u8bdd\uff0c\u4e5f\u8bb8\u4f1a\u5bf9"\u963b\u585e"\u4e0e"\u6302\u8d77"\u7684\u533a\u522b\u6bd4\u8f83\u4e86\u89e3\u3002'),(0,l.kt)("p",{parentName:"admonition"},"\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6765\u6302\u8d77\u7b49\u5f85\u4e0e\u5728\u4ee3\u7801\u4e2d\u76f4\u63a5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"Thread.sleep(...)"),' \u4e0d\u540c\uff0c\n"\u6302\u8d77"\u53ef\u4ee5\u66f4\u6709\u6548\u5730\u5229\u7528\u4f60\u7684\u8d44\u6e90\uff0c\u5c06\u6302\u8d77\u671f\u95f4\u7684\u8d44\u6e90\u8ba9\u4e88\u670b\u53cb\u4eec\u5206\u4eab\u3002'),(0,l.kt)("p",{parentName:"admonition"},"\u6211\u4eec\u4e0d\u5efa\u8bae\u5728\u76d1\u542c\u51fd\u6570\u7684\u5904\u7406\u903b\u8f91\u4e2d\u51fa\u73b0\u4efb\u4f55\u963b\u585e\u4ee3\u7801\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u5c24\u5176\u662f")," ",(0,l.kt)("inlineCode",{parentName:"p"},"Thread.sleep(...)"),"\n\u8fd9\u79cd\u5f88\u5bb9\u6613\u88ab\u4f7f\u7528\u7684\u4e1c\u897f\u3002")),(0,l.kt)("p",null,"\u8fd8\u8bb0\u5f97\u6211\u4eec\u4e00\u5f00\u59cb\u8bf4\u7684\u5417\uff1f\u53ea\u6709\u5f53result\u7684\u7c7b\u578b\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"ReactivelyCollectableEventResult"),"\n\u7684\u65f6\u5019\uff0c\u8fd9\u79cd\u7279\u6b8a\u7684\u6536\u96c6\u624d\u6709\u6548\u679c\u3002 \u800c\u4e0a\u8ff0\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u7684\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.of(...)"),"\n\u6765\u6784\u5efa\u5904\u7406\u7ed3\u679c\u5bf9\u8c61\u7684\u3002"),(0,l.kt)("p",null,"\u6211\u60f3\u4f60\u53ef\u80fd\u731c\u5230\u4e86\uff0c\u5728\u6838\u5fc3\u5e93\u4e2d\u7684\u9ed8\u8ba4\u5b9e\u73b0\u91cc\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.of(...)"),"\n\u7684\u6700\u7ec8\u7ed3\u679c\u4fbf\u662f\u5c5e\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"ReactivelyCollectableEventResult")," \u7c7b\u578b\u7684\u3002\u56e0\u6b64\u5982\u679c\u6ca1\u6709\u4ec0\u4e48\u7279\u6b8a\u8981\u6c42\u7684\u8bdd\uff0c\n\u76f4\u63a5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.of(...)")," \u8fd4\u56de\u4f60\u7684\u7ed3\u679c\u5c31\u597d\u4e86\u3002"),(0,l.kt)("h4",{id:"\u5f02\u6b65\u7684\u5904\u7406\u7ed3\u679c"},"\u5f02\u6b65\u7684\u5904\u7406\u7ed3\u679c"),(0,l.kt)("p",null,"\u8bb2\u5b8c\u4e86\u5bf9\u53ef\u54cd\u5e94\u5f0f\u7684\u5904\u7406\u7ed3\u679c\uff0c\u6211\u4eec\u601d\u8003\u4e00\u4e2a\u95ee\u9898\uff1a\u5982\u679c\u6211\u60f3\u8981\u8ba9\u6211\u7684\u76d1\u542c\u51fd\u6570\u771f\u6b63\u7684\u5728",(0,l.kt)("strong",{parentName:"p"},"\u5f02\u6b65"),"\u4e2d\u6267\u884c\uff0c\n\u6211\u4e0d\u5e0c\u671b\u5728\u5904\u7406\u7ed3\u675f\u540e\u8fd8\u8981\u6302\u8d77\u7b49\u5f85\u7ed3\u679c\uff0c\u800c\u662f\u5728\u5f02\u6b65\u5f00\u542f\u540e\u7acb\u523b\u8fdb\u5165\u4e0b\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u4e2d\uff0c\u6211\u5e94\u8be5\u600e\u4e48\u529e\uff1f"),(0,l.kt)("p",null,"\u5355\u72ec\u5b9e\u73b0\u4e00\u4e2a\u4e0d\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"ReactivelyCollectableEventResult")," \u7684\u7c7b\u578b\u5417\uff1f\u5176\u5b9e\u4e0d\u7528\uff0c\u6838\u5fc3\u5e93\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"SpecialEventResult"),"\n\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7528\u4e8e\u63cf\u8ff0\u5f02\u6b65\u7ed3\u679c\u884c\u4e3a\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"AsyncEventResult"),"\u3002"),(0,l.kt)("p",null,"\u9996\u5148\u6765\u770b\u770b\u5b83\u5927\u6982\u7684\u5b9a\u4e49\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"public abstract class AsyncEventResult : SpecialEventResult() {\n    /**\n     * \u7528\u6765\u8868\u793a\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1\u7684 [content], \u4f8b\u5982 [Deferred] \u6216 [Future].\n     */\n    abstract override val content: Any?\n    \n    /**\n     * \u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u5f02\u6b65\u4efb\u52a1\u5c06\u4e0d\u4f1a\u963b\u65ad\u540e\u7eed\u4e8b\u4ef6\u7684\u6267\u884c\u3002\n     */\n    override val isTruncated: Boolean get() = false\n    \n    /**\n     * \u5c06\u7ed3\u679c\u8f6c\u5316\u4e3a [Future].\n     */\n    public abstract fun contentAsFuture(): Future<EventResult>\n    \n    /**\n     * \u7b49\u5f85 [content] \u7684\u5f02\u6b65\u4efb\u52a1\u54cd\u5e94\u3002\n     */\n    public abstract suspend fun awaitContent(): EventResult\n}\n")),(0,l.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u6bd4\u666e\u901a\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult")," \u591a\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7528\u6765\u83b7\u53d6\u5f02\u6b65\u4efb\u52a1\u7ed3\u679c\u7684\u80fd\u529b\uff0c\u5e76\u4e14\u9ed8\u8ba4\u60c5\u51b5\u4e0b\n",(0,l.kt)("inlineCode",{parentName:"p"},"isTruncated")," \u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"false"),"\u3002"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"AsyncEventResult")," \u5176\u4e0d\u5c5e\u4e8e ",(0,l.kt)("inlineCode",{parentName:"p"},"ReactivelyCollectableEventResult")," \u7c7b\u578b\uff0c\u56e0\u6b64\u5b83\u7684\u7ed3\u679c\u4f1a\u88ab",(0,l.kt)("strong",{parentName:"p"},"\u76f4\u63a5"),"\u7f6e\u5165\n",(0,l.kt)("inlineCode",{parentName:"p"},"EventProcessingContent.results")," \u4e2d\uff0c\u4e0d\u4f1a\u88ab\u6302\u8d77\u7b49\u5f85\u3002"),(0,l.kt)("p",null,"\u5982\u679c\u60f3\u8981\u83b7\u53d6\u6838\u5fc3\u5e93\u4e2d\u63d0\u4f9b\u7684\u9ed8\u8ba4\u5b9e\u73b0\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.async(...)")," \u6765\u5f97\u5230\u3002"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.async")," \u9700\u8981\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"Deferred")," \u7c7b\u578b\u7684\u53c2\u6570\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = simpleListener(FooEvent) { event ->\n    EventResult.async(event.bot.async {\n        // \u7b49\u5f855s\n        delay(5000)\n        // \u5f97\u5230\u771f\u6b63\u7684\u4e8b\u4ef6\u54cd\u5e94\u503c\n        EventResult.of("Hello")\n    })\n}\n')),(0,l.kt)("p",null,"\u6216\u8005\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"CoroutineScope")," \u6765\u7ec4\u5408 ",(0,l.kt)("inlineCode",{parentName:"p"},"async")," \u7684\u884c\u4e3a\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},'val listener = simpleListener(FooEvent) { event ->\n    // \u4e0e CoroutineScope.async(...) { ... } \u7684\u4f7f\u7528\u65b9\u5f0f\u57fa\u672c\u4e00\u81f4\n    EventResult.async(event.bot) {\n        // \u7b49\u5f855s\n        delay(5000)\n        // \u5f97\u5230\u771f\u6b63\u7684\u4e8b\u4ef6\u54cd\u5e94\u503c\n        EventResult.of("Hello")\n    }\n}\n')),(0,l.kt)("admonition",{title:"\u6df1\u85cf\u4e0d\u9732",type:"tip"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("inlineCode",{parentName:"p"},"Bot")," \u5b9e\u73b0\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"CoroutineScope"),"\u3002"))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.async")," \u9700\u8981\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"CompletableFuture")," \u7c7b\u578b\u7684\u53c2\u6570\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'EventListener listener = SimpleListeners.listener(Event.Root, (context, event) -> {\n    final DelayableCompletableFuture<EventResult> future = event.getBot()\n            // \u7b49\u5f855s\n            .delayAndCompute(5000, () -> {\n                // \u5f97\u5230\u771f\u6b63\u7684\u7ed3\u679c\n                return EventResult.of("Async Result");\n            });\n            \n    return EventResult.async(future);\n});\n')))),(0,l.kt)("p",null,"\u4e5f\u8bb8\u4f60\u5df2\u7ecf\u53d1\u73b0\u4e86\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult.async")," \u4e2d\u5bf9\u4e8e\u5f02\u6b65\u7ed3\u679c\u7684\u7c7b\u578b\uff0c\u8981\u6c42\u5b83\u4eec\u4ecd\u7136\u4e3a\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"EventResult"),"\u3002"),(0,l.kt)("h2",{id:"\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u5668"},"\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u5668"),(0,l.kt)("p",null,"\u5728\u6838\u5fc3\u5e93\u4e2d\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrar")," \u4fbf\u662f\u76d1\u542c\u51fd\u6570\u7684\u4e3b\u8981\u53bb\u5411\u3002",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrar")," \u4ee3\u8868",(0,l.kt)("strong",{parentName:"p"},"\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u5668"),"\uff0c\n\u5b83\u901a\u5e38\u7531 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerManager")," \u4e5f\u5c31\u662f\u76d1\u542c\u51fd\u6570\u7ba1\u7406\u5668\uff08\u6216\u8005\u79f0\u4e4b\u4e3a\u4e8b\u4ef6\u8c03\u5ea6\u5668\uff09\u5b9e\u73b0\uff0c\u627f\u8f7d\u7740\u6ce8\u518c\u76d1\u542c\u51fd\u6570\u7684\u804c\u8d23\u3002"),(0,l.kt)("h3",{id:"\u5b9a\u4e49-1"},"\u5b9a\u4e49"),(0,l.kt)("p",null,"\u6309\u7167\u60ef\u4f8b\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrar"),"\uff08\u6709\u6240\u7b80\u5316\uff09\u7684\u57fa\u672c\u5b9a\u4e49\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"public interface EventListenerRegistrar {\n    /**\n     * \u6ce8\u518c\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u3002\u5bf9\u4e8e\u6ce8\u518c\u7684\u5176\u4ed6\u9644\u52a0\u5c5e\u6027\u5747\u91c7\u7528\u9ed8\u8ba4\u503c.\n     */\n    public fun register(listener: EventListener): EventListenerHandle\n    \n    /**\n     * \u6ce8\u518c\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u3002\n     */\n    public fun register(registrationDescription: EventListenerRegistrationDescription): EventListenerHandle\n}\n")),(0,l.kt)("p",null,"\u53ef\u4ee5\u770b\u51fa\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrar")," \u7684\u4f5c\u7528\u5c31\u662f\u6ce8\u518c\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\uff0c\u5e76\u5f97\u5230\u8fd9\u4e2a\u76d1\u542c\u51fd\u6570\u7684",(0,l.kt)("a",{parentName:"p",href:"#eventlistenerhandle"},"\u53e5\u67c4"),"\u3002"),(0,l.kt)("h3",{id:"\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u63cf\u8ff0"},"\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u63cf\u8ff0"),(0,l.kt)("p",null,"\u4f60\u4e5f\u8bb8\u6ce8\u610f\u5230\u4e86\uff0c\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrar.register(...)")," \u4e2d\uff0c\u9664\u4e86\u53ef\u4ee5\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener")," \u4f5c\u4e3a\u53c2\u6570\uff0c\n\u8fd8\u51fa\u73b0\u4e86\u4e00\u4e2a\u65b0\u7684\u7c7b\u578b\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrationDescription"),"\u3002\u5b83\u7684\u610f\u601d\u662f",(0,l.kt)("strong",{parentName:"p"},"\u76d1\u542c\u51fd\u6570\u7528\u4e8e\u6ce8\u518c\u7684\u63cf\u8ff0"),"\uff0c\n\u7528\u6765\u63cf\u8ff0\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u88ab\u6ce8\u518c\u540e\u7684\u57fa\u672c\u5c5e\u6027\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u9996\u5148\u6765\u770b\u770b\u5b83\u7684\u5b9a\u4e49\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"public abstract class EventListenerRegistrationDescription {\n    \n    /**\n     * \u6ce8\u518c\u4fe1\u606f\u4e2d\u7684\u76d1\u542c\u51fd\u6570.\n     */\n    public abstract val listener: EventListener\n    \n    /**\n     * \u6b64\u76d1\u542c\u51fd\u6570\u7684\u4f18\u5148\u7ea7. \u9ed8\u8ba4\u4e3a [DEFAULT_PRIORITY].\n     *\n     * @see PriorityConstant\n     */\n    public open var priority: Int = DEFAULT_PRIORITY\n    \n    /**\n     * \u5f53\u524d\u7684\u76d1\u542c\u51fd\u6570\u662f\u5426\u8981\u5f02\u6b65\u5730\u4f7f\u7528. \u9ed8\u8ba4\u4e3a [DEFAULT_ASYNC].\n     */\n    public open var isAsync: Boolean = DEFAULT_ASYNC\n    \n    //// ...\n}\n")),(0,l.kt)("p",null,"\u4ed6\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u7528\u6765\u5305\u88c5\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\uff0c\u5e76\u4e3a\u5176\u63d0\u4f9b\u66f4\u591a\u7684\u989d\u5916\u5c5e\u6027\u3002\n\u8fd9\u4e9b\u5c5e\u6027\u5927\u90e8\u5206\u5bf9\u4e8e\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u672c\u8eab\u6765\u8bb2\u5e76\u4e0d\u91cd\u8981\uff0c \u4f46\u662f\u5374\u53ef\u4ee5\u4f7f\u7528\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerManager")," \u4e2d\u3002\n\u56e0\u6b64\u6211\u4eec\u5c06\u8fd9\u4e8c\u8005\u62c6\u5206\uff0c\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener")," \u63cf\u8ff0\u4e8b\u4ef6\u5904\u7406\u7684\u903b\u8f91\uff0c\u800c\u5728\u6ce8\u518c\u65f6\u4f7f\u7528\n",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrationDescription")," \u63d0\u4f9b\u66f4\u591a\u53ef\u7528\u7684\u5c5e\u6027\u4fe1\u606f\u3002"),(0,l.kt)("p",null,"\u8fd9\u4e5f\u4f7f\u5f97 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener")," \u7684\u91cd\u7528\u6210\u4e3a\u53ef\u80fd\u3002"),(0,l.kt)("p",null,"\u5c06\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener")," \u8f6c\u53d8\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrationDescription")," \u7684\u65b9\u5f0f\u5e76\u4e0d\u552f\u4e00\uff0c\n\u6bd4\u5982\u4f60\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrationDescription")," \u7c7b\u578b\u5e76\u4f7f\u7528\u5b83\u3002\n\u4e0d\u8fc7\u6838\u5fc3\u5e93\u5df2\u7ecf\u4e3a\u4f60\u63d0\u4f9b\u597d\u4e86\u7b80\u5355\u7684\u5b9e\u73b0\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrationDescription"),"\n\u81ea\u8eab\u63d0\u4f9b\u7684\u6784\u9020\u65b9\u6cd5\u6765\u5f97\u5230\u5b83\u4eec\u3002"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("p",null,"\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener.toRegistrationDescription(...)")," \u6269\u5c55\u51fd\u6570\u5c06\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener")," \u8fdb\u884c\u5305\u88c5\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener: EventListener = ...\nval registrationDescription = listener.toRegistrationDescription(priority = 1, isAsync = true)\n")),(0,l.kt)("p",null,"\u6216\u901a\u8fc7\u7b80\u6613DSL\u7684\u65b9\u5f0f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener: EventListener = ...\nval registrationDescription = listener.toRegistrationDescription {\n    priority = 1\n    isAsync = true\n}\n"))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("p",null,"\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrationDescription.of(...)")," \u5c06\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListener")," \u8fdb\u884c\u5305\u88c5\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"EventListener listener = ...\n\nEventListenerRegistrationDescription description = EventListenerRegistrationDescription.Companion.of(listener);\ndescription.setAsync(true);\ndescription.setPriority(PriorityConstant.FIRST);\n")))),(0,l.kt)("h2",{id:"\u76d1\u542c\u51fd\u6570\u7684\u6ce8\u518c"},"\u76d1\u542c\u51fd\u6570\u7684\u6ce8\u518c"),(0,l.kt)("p",null,"\u4e0a\u9762\u6211\u4eec\u63d0\u5230\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrar"),"\uff0c\u5b83\u662f\u7528\u6765\u6ce8\u518c\u4e00\u4e2a\u76d1\u542c\u51fd\u6570\u7684\u3002\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"register(...)")," \u65b9\u6cd5\u5373\u53ef\u5b8c\u6210\u5bf9\u76d1\u542c\u51fd\u6570\u7684\u52a8\u6001\u6ce8\u518c\u3002"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u76f4\u63a5\u6ce8\u518c\u76d1\u542c\u51fd\u6570:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener: EventListener = ...\nval handle = eventListenerRegistrar.register(listener)\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u901a\u8fc7\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u4fe1\u606f\u6ce8\u518c:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener: EventListener = ...\nval description = listener.toRegistrationDescription {\n    // ...\n}\nval handle = eventListenerRegistrar.register(description)\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u91cd\u590d\u6ce8\u518c:")),(0,l.kt)("p",null,"\u76d1\u542c\u51fd\u6570\uff08\u6216\u8005\u76d1\u542c\u51fd\u6570\u7684\u6ce8\u518c\u63cf\u8ff0\uff09\u662f\u53ef\u4ee5\u91cd\u590d\u6ce8\u518c\u7684\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener: EventListener = ...\n\nval handle1 = eventListenerRegistrar.register(listener)\nval handle2 = eventListenerRegistrar.register(listener)\n\n// handle1 != handle2\n")),(0,l.kt)("p",null,"\u6b64\u65f6\u76d1\u542c\u51fd\u6570\u7ba1\u7406\u5668\u4e2d\u5c06\u4f1a\u5b58\u5728\u4e24\u4e2a\u76f8\u540c\u7684\u76d1\u542c\u51fd\u6570\u903b\u8f91\uff0c\u5e76\u4e14\u6ce8\u518c\u800c\u5f97\u7684\u53e5\u67c4\u4e5f\u5e76\u4e0d\u76f8\u540c\u3002")),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u76f4\u63a5\u6ce8\u518c\u76d1\u542c\u51fd\u6570:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"EventListener listener = ...;\n\nEventListenerHandle handle = eventListenerRegistrar.register(listener);\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u901a\u8fc7\u76d1\u542c\u51fd\u6570\u6ce8\u518c\u4fe1\u606f\u6ce8\u518c:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"EventListener listener = ...;\n\nEventListenerRegistrationDescription description = EventListenerRegistrationDescription.of(listener);\n\n// ...\n\nEventListenerHandle handle = eventListenerRegistrar.register(listener);\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u91cd\u590d\u6ce8\u518c:")),(0,l.kt)("p",null,"\u76d1\u542c\u51fd\u6570\uff08\u6216\u8005\u76d1\u542c\u51fd\u6570\u7684\u6ce8\u518c\u63cf\u8ff0\uff09\u662f\u53ef\u4ee5\u91cd\u590d\u6ce8\u518c\u7684\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"EventListener listener = ...;\n\n\nEventListenerHandle handle1 = eventListenerRegistrar.register(listener);\nEventListenerHandle handle2 = eventListenerRegistrar.register(listener);\n\n// handle1.equals(handle2); // false\n")),(0,l.kt)("p",null,"\u6b64\u65f6\u76d1\u542c\u51fd\u6570\u7ba1\u7406\u5668\u4e2d\u5c06\u4f1a\u5b58\u5728\u4e24\u4e2a\u76f8\u540c\u7684\u76d1\u542c\u51fd\u6570\u903b\u8f91\uff0c\u5e76\u4e14\u6ce8\u518c\u800c\u5f97\u7684\u53e5\u67c4\u4e5f\u5e76\u4e0d\u76f8\u540c\u3002"))),(0,l.kt)("h3",{id:"\u76d1\u542c\u51fd\u6570\u53e5\u67c4"},"\u76d1\u542c\u51fd\u6570\u53e5\u67c4"),(0,l.kt)("p",null,"\u4f60\u53ef\u80fd\u6ce8\u610f\u5230\u4e86\u4e0a\u9762\u793a\u4f8b\u4e2d\u51fa\u73b0\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerHandle")," \u7c7b\u578b\u3002\u5b83\u5728\u901a\u8fc7 ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerRegistrar.register")," \u65f6\u8fd4\u56de\uff0c\n\u4ee3\u8868\u4e3a\u672c\u6b21\u6ce8\u518c\u540e\u76d1\u542c\u51fd\u6570\u7684",(0,l.kt)("strong",{parentName:"p"},"\u53e5\u67c4"),"\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},'"\u53e5\u67c4"\u5982\u679c\u4e0d\u592a\u597d\u7406\u89e3\uff0c\u6309\u7167\u4f60\u7684\u60f3\u6cd5\u7ffb\u8bd1\u5b83\u5c31\u597d\u4e86\u3002')),(0,l.kt)("p",null,"\u8ba9\u6211\u4eec\u5148\u6765\u770b\u770b ",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerHandle")," \u7684\u5b9a\u4e49\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"/**\n * \u88ab\u6ce8\u518c\u540e\u76d1\u542c\u51fd\u6570\u7684\u53e5\u67c4.\n */\npublic interface EventListenerHandle {\n    \n    /**\n     * \u5c06\u5f53\u524d\u76d1\u542c\u51fd\u6570\u79fb\u9664\u4e8e\u76ee\u6807\u5bb9\u5668\u4e2d.\n     *\n     * @return \u662f\u5426\u79fb\u9664\u6210\u529f. \u5982\u679c\u76ee\u6807\u5bb9\u5668\u4e2d\u5df2\u7ecf\u4e0d\u5b58\u5728\u5f53\u524d\u53e5\u67c4\u6240\u63cf\u8ff0\u7684\u76d1\u542c\u51fd\u6570\u5219\u4f1a\u5f97\u5230 `false`.\n     */\n    public fun dispose(): Boolean\n    \n    /**\n     * \u5224\u65ad\u5f53\u524d\u53e5\u67c4\u6240\u63cf\u8ff0\u7684\u76d1\u542c\u51fd\u6570\u662f\u5426\u5b58\u5728\u4e8e\u76ee\u6807\u5bb9\u5668\u4e2d.\n     */\n    public val isExists: Boolean\n    \n    /**\n     * \u6b64\u53e5\u67c4\u6240\u5c5e\u7684 [EventListenerContainer].\n     */\n    public val container: EventListenerContainer\n    \n}\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerHandle")," \u53ef\u4ee5\u7528\u6765\u63cf\u8ff0\u672c\u6b21\u88ab\u6ce8\u518c\u540e\u7684\u76d1\u542c\u51fd\u6570\u5728\u5bb9\u5668\u4e2d\u7684",(0,l.kt)("strong",{parentName:"p"},"\u72b6\u6001"),"\uff0c\u5e76\u5141\u8bb8\u4f60",(0,l.kt)("strong",{parentName:"p"},"\u5355\u5411"),"\u7684\u5bf9\u5b83\u8fdb\u884c\u4e00\u5b9a\u7a0b\u5ea6\u7684\u64cd\u4f5c\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u72b6\u6001")),(0,l.kt)("p",null,"\u72b6\u6001\u8bf4\u767d\u4e86\u5c31\u662f\u901a\u8fc7\u5c5e\u6027 ",(0,l.kt)("inlineCode",{parentName:"p"},"isExists")," \u5224\u65ad\u8fd9\u4e2a\u76d1\u542c\u51fd\u6570\u662f\u5426\u8fd8\u5b58\u5728\u4e8e\u5bb9\u5668\u4e2d\u3002\u5982\u679c\u5f53\u524d\u53e5\u67c4\u6240\u63cf\u8ff0\u7684\u76d1\u542c\u51fd\u6570\u5df2\u7ecf\u88ab ",(0,l.kt)("inlineCode",{parentName:"p"},"dispose"),"\uff0c\n\u90a3\u4e48 ",(0,l.kt)("inlineCode",{parentName:"p"},"isExists")," \u5c06\u4f1a\u5f97\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"false"),"\u3002"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u5355\u9879\u64cd\u4f5c")),(0,l.kt)("p",null,"\u4e0a\u9762\u63d0\u5230\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"EventListenerHandle")," \u5141\u8bb8 ",(0,l.kt)("inlineCode",{parentName:"p"},"dispose")," \u64cd\u4f5c\uff0c\u5373\u5c06\u5176\u63cf\u8ff0\u7684\u76d1\u542c\u51fd\u6570\u4ece\u5176\u6240\u5c5e\u7684\u5bb9\u5668\u4e2d",(0,l.kt)("strong",{parentName:"p"},"\u79fb\u9664"),"\u3002"),(0,l.kt)(i.Z,{groupId:"code",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val listener: EventListener = ...\nval handle = eventListenerRegistrar.register(listener)\n\nhandle.dispose()\n"))),(0,l.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"EventListener listener = ...;\nEventListenerHandle handle = eventListenerRegistrar.register(listener);\n\nhandle.dispose();\n")))))}v.isMDXComponent=!0},1748:(e,n,t)=>{var a={"./locale":9234,"./locale.js":9234};function l(e){var n=r(e);return t(n)}function r(e){if(!t.o(a,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return a[e]}l.keys=function(){return Object.keys(a)},l.resolve=r,e.exports=l,l.id=1748},8209:(e,n,t)=>{"use strict";t.d(n,{G:()=>i});var a=t(7294),l=t(1304);const r="light";const i=({chart:e,config:n})=>{if("undefined"==typeof window)return a.createElement("div",{className:"mermaid","data-mermaid-src":e},e);const t=(0,a.useMemo)((()=>"string"==typeof n?JSON.parse(n):n),[n]),i=document.querySelector("html"),[s,o]=(0,a.useState)(!1),p=(0,a.useMemo)((()=>function(e,n){let t=e.getAttribute("data-theme")??r;t!==r&&"dark"!==t&&(t=r);const a=t===r?"default":"dark";return n?.theme?.[t]??n?.mermaid?.theme??a}(i,t)),[t,s]);return(0,a.useEffect)((()=>{const e=new MutationObserver((e=>{for(const n of e)if("attributes"===n.type&&"data-theme"===n.attributeName){o((e=>!e));break}}));return e.observe(i,{attributes:!0}),()=>{try{e.disconnect()}catch{}}}),[]),(0,a.useEffect)((()=>{t&&(t.mermaid?l.Z.initialize({startOnLoad:!0,...t.mermaid,theme:p}):l.Z.initialize({startOnLoad:!0,theme:p}),document.querySelectorAll('div.mermaid[data-processed="true"]').forEach((e=>{e.removeAttribute("data-processed"),e.innerHTML=e.getAttribute("data-mermaid-src")})),l.Z.contentLoaded())}),[t,p]),(0,a.useEffect)((()=>{document.querySelectorAll('div.mermaid[data-processed="true"]').forEach((e=>{e.removeAttribute("data-processed"),e.innerHTML=e.getAttribute("data-mermaid-src")})),setTimeout(l.Z.contentLoaded,0)}),[e]),a.createElement("div",{className:"mermaid","data-mermaid-src":e},e)}}}]);